@page "/question/upload"
@inject NavigationManager Nav

<MudContainer MaxWidth="MaxWidth.Large">
    <!-- Breadcrumb -->
    <MudBreadcrumbs Items="_breadcrumbs" Style="margin-top:2px;" />
    <MudText Typo="Typo.h5" Class="font-bold p-2 ms-2" Style="@($"color:{Colors.Blue.Darken3};")">
        Tải lên câu hỏi
    </MudText>

    <!-- Chọn Khoa, Môn, Chương/Phần -->
    <MudPaper Elevation="2" Class="pa-4 mb-6">
        <MudText Typo="Typo.subtitle1" Class="mb-3">Chọn khoa, môn học và chương/phần</MudText>
        <MudGrid Spacing="3">
            <MudItem sm="4">
                <MudSelect T="string" 
                           Label="Khoa" 
                           Placeholder="-- Chọn khoa --" 
                           Variant="Variant.Outlined" 
                           Required="true"
                           Value="@(SelectedKhoa?.ToString())"
                           ValueChanged="@(s => OnKhoaChanged(s != null ? Guid.Parse(s) : null))"
                >
                    @foreach (var khoa in Khoas)
                    {
                        <MudSelectItem Value="@khoa.MaKhoa.ToString()" >@khoa.TenKhoa</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>

            <MudItem sm="4">
                <MudSelect T="string" 
                           Label="Môn học" 
                           Placeholder="-- Chọn môn học --" 
                           Variant="Variant.Outlined" 
                           Required="true"
                           Value="@(SelectedMonHoc?.ToString())"
                           ValueChanged="@(s => OnMonHocChanged(s != null ? Guid.Parse(s) : null))"
                           Disabled="@(SelectedKhoa == null)">
                    @foreach (var mon in MonHocs)
                    {
                        <MudSelectItem Value="@mon.MaMonHoc.ToString()">@mon.TenMonHoc</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>

            <MudItem sm="4">
                <MudSelect T="string" 
                           Label="Chương/Phần" 
                           Placeholder="-- Chọn chương/phần --" 
                           Variant="Variant.Outlined" 
                           Required="true"
                           Value="@(SelectedPhanId?.ToString())"
                           ValueChanged="@(s => SelectedPhanId = s != null ? Guid.Parse(s) : null)"
                           Disabled="@(SelectedMonHoc == null)">
                    @foreach (var phan in Phans)
                    {
                        <MudSelectItem Value="@phan.MaPhan.ToString()">
                            @if (phan.MaPhanCha == null)
                            {
                                <strong>@phan.TenPhan</strong>
                            }
                            else
                            {
                                <span style="margin-left: 20px;">└ @phan.TenPhan</span>
                            }
                        </MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
        </MudGrid>
    </MudPaper>

    <!-- Hai cột: Upload Word & Upload ZIP -->
    <MudGrid>
        <!-- CỘT 1: Upload Word -->
        <MudItem xs="6">
            <MudPaper Elevation="2" Class="pa-6" Style="border-radius: 16px; background-color: #fff;">
                <MudStack Row="true" AlignItems="@AlignItems.Center" Spacing="1" Class="mb-4">
                    <MudIcon Icon="@Icons.Material.Filled.Description" 
                             Style="@($"color:{Colors.Blue.Darken3};")" Size="Size.Medium" />
                    <MudText Typo="Typo.h6" Class="fw-bold" Style="@($"color:{Colors.Blue.Darken3};")">
                        Nhập từ Word
                    </MudText>
                    <MudTooltip Text="Tải lên file Word để hệ thống tự động đọc câu hỏi từ nội dung.">
                        <MudIcon Icon="@Icons.Material.Filled.Info" Color="Color.Default" Size="Size.Small" Class="ms-1" />
                    </MudTooltip>
                </MudStack>

                <div class="border-dashed border-primary"
                     style="border: 2px dashed #3f51b5; border-radius: 10px; padding: 40px; text-align: center;">
                    <MudIcon Icon="@Icons.Material.Filled.Description" Size="Size.Large" Class="mb-2" Style="@($"color:{Colors.Blue.Darken3};")" />
                    <MudText Typo="Typo.subtitle1" Class="fw-semibold mb-1">Tải lên file Word</MudText>
                    <MudText Typo="Typo.body2" Class="text-muted">
                        Kéo thả hoặc nhấp để chọn file<br />
                        Hỗ trợ: .docx, .doc
                    </MudText>
                    <InputFile OnChange="@OnWordFileSelected" accept=".docx,.doc" />
                </div>

                <MudButton Variant="Variant.Outlined"
                           StartIcon="@Icons.Material.Filled.Info"
                           Style="@($"color:{Colors.Blue.Darken3};")"
                           FullWidth="true"
                           Class="mt-4 fw-semibold">
                    Xem hướng dẫn định dạng Word
                </MudButton>

                <MudPaper Elevation="0" Class="p-4 mt-4" Style="background-color: #f5f8ff; border-radius: 12px;">
                    <MudText Typo="Typo.subtitle2" Class="fw-semibold mb-2 d-flex align-items-center"
                             Style="@($"color:{Colors.Blue.Darken3};")">
                        <MudIcon Icon="@Icons.Material.Filled.Settings" Size="Size.Small" Class="me-1" />
                        Tính năng:
                    </MudText>
                    <MudList T="string" Dense="true">
                        <MudListItem T="string">Phân tích câu hỏi từ file Word</MudListItem>
                        <MudListItem T="string">Tự động nhận diện CLO</MudListItem>
                        <MudListItem T="string">Hỗ trợ LaTeX và công thức toán</MudListItem>
                        <MudListItem T="string">Xử lý định dạng gạch chân (Hoán vị)</MudListItem>
                    </MudList>
                </MudPaper>
            </MudPaper>
        </MudItem>

        <!-- CỘT 2: Upload ZIP -->
        <MudItem xs="6">
            <MudPaper Elevation="2" Class="pa-6" Style="border-radius: 16px; background-color: #fff;">
                <MudStack Row="true" AlignItems="@AlignItems.Center" Spacing="1" Class="mb-4">
                    <MudIcon Icon="@Icons.Material.Filled.FolderZip" Style="@($"color:{Colors.Green.Darken2};")" Size="Size.Medium"/>
                    <MudText Typo="Typo.h6" Class="fw-bold" Style="@($"color:{Colors.Green.Darken2};")">
                        Upload File Zip
                    </MudText>
                    <MudTooltip Text="Tải lên tệp ZIP để hệ thống tự động đọc cấu trúc và nội dung.">
                        <MudIcon Icon="@Icons.Material.Filled.Info" Style="@($"color:{Colors.Green.Darken2};")" Size="Size.Small" Class="ms-1"/>
                    </MudTooltip>
                </MudStack>

                <div class="border-dashed border-success"
                     style="border: 2px dashed #4caf50; border-radius: 10px; padding: 40px; text-align: center;">
                    <MudIcon Icon="@Icons.Material.Filled.FolderZip" Size="Size.Large" Class="mb-2" Style="@($"color:{Colors.Green.Darken2};")"/>
                    <MudText Typo="Typo.subtitle1" Class="fw-semibold mb-1 text-success">Tải lên tệp ZIP</MudText>
                    <MudText Typo="Typo.body2" Class="text-muted">
                        Kéo thả hoặc nhấp để chọn file ZIP<br/>
                        Hỗ trợ: .zip (tối đa 100MB)
                    </MudText>
                    <InputFile OnChange="@OnZipFileSelected" accept=".zip"/>
                </div>

                <MudButton Variant="Variant.Outlined"
                           StartIcon="@Icons.Material.Filled.Info"
                           Style="@($"color:{Colors.Green.Darken2};")"
                           FullWidth="true"
                           Class="mt-4 fw-semibold">
                    Xem hướng dẫn định dạng ZIP
                </MudButton>

                <MudPaper Elevation="0" Class="p-4 mt-4" Style="background-color: #e9f8f0; border-radius: 12px;">
                    <MudText Typo="Typo.subtitle2" Class="fw-semibold mb-2 d-flex align-items-center"
                             Style="@($"color:{Colors.Green.Darken2};")">
                        <MudIcon Icon="@Icons.Material.Filled.Settings" Size="Size.Small" Class="me-1"/>
                        Cấu trúc gói đề
                    </MudText>
                    <MudList T="string" Dense="true">
                        <MudListItem T="string">File Word (.docx) – Bắt buộc</MudListItem>
                        <MudListItem T="string">Thư mục /audio – Tùy chọn</MudListItem>
                        <MudListItem T="string">Thư mục /images – Tùy chọn</MudListItem>
                        <MudListItem T="string">Tự động chuyển đổi WebP</MudListItem>
                    </MudList>
                </MudPaper>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>
