@page "/create-question/single"
@inherits CreateSingleQuestionBase
<MudContainer MaxWidth="MaxWidth.ExtraLarge" Style="padding: 20px ">
    
    <MudText Typo="Typo.h5" Class="font-bold p-3 ms-2" Style="@($"color:{Colors.Blue.Darken3};")">
        Tạo câu hỏi đơn
    </MudText>
    <MudGrid >
        <!-- CỘT TRÁI -->
        <MudItem xs="12" md="8" Style="display: flex; flex-direction: column;">
            <MudPaper Class="p-4 rounded-lg shadow-sm bg-grey-lighten-5 flex-grow"
                      Style="overflow-y: auto;">
                <MudText Typo="Typo.subtitle1" Class="text-error font-semibold mb-1">Nội dung câu hỏi</MudText>

                <MudTextField @bind-Value="QuestionContent"
                              Placeholder="Nhập nội dung câu hỏi..."
                              Lines="5"
                              FullWidth="true"
                              Variant="Variant.Outlined"
                              Class="mb-4"/>

                <MudDivider Class="my-3"/>

                <MudText Typo="Typo.subtitle1" Class="font-semibold mb-2">Câu trả lời</MudText>

                <MudScrollArea Style="max-height: 300px;">
                    @foreach (var answer in Answers)
                    {
                        <MudPaper Class="d-flex align-items-center mb-2 p-2 rounded-lg bg-grey-lighten-4">
                            <MudTextField @bind-Value="answer.Text"
                                          Placeholder="Nhập câu trả lời..."
                                          Lines="2"
                                          Variant="Variant.Outlined"
                                          Class="flex-grow-1"/>

                            <MudIconButton Icon="@Icons.Material.Filled.Check"
                                           Color="@(answer.IsCorrect ? Color.Success : Color.Default)"
                                           OnClick="() => ToggleCorrectAnswer(answer)"
                                           Tooltip="Đặt làm đáp án đúng"
                                           Class="ms-2"
                                           Style="@(
                                                  answer.IsCorrect
                                                      ? $"background-color:{Colors.Green.Lighten5}; color:{Colors.Green.Darken2}; border-radius:8px;"
                                                      : $"color:{Colors.Gray.Darken1}; opacity:0.7;"
                                                  )"/>

                            <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                           Style="@($"color:{Colors.Red.Darken3};")"
                                           OnClick="() => RemoveAnswer(answer)"
                                           Tooltip="Xóa câu trả lời"
                                           Class="ms-1"/>
                        </MudPaper>
                    }
                </MudScrollArea>

                <MudButton Variant="Variant.Outlined"
                           Style="@($"color:{Colors.Blue.Darken3};")"
                           StartIcon="@Icons.Material.Filled.Add"
                           OnClick="AddAnswer"
                           Class="w-100 mt-3">
                    Thêm câu trả lời
                </MudButton>
            </MudPaper>
        </MudItem>

        <!-- CỘT PHẢI -->
        <MudItem xs="12" md="4" Style="height: 550px;">
            <MudPaper Class="p-5 rounded-lg shadow-sm bg-grey-lighten-5 h-100"
            >
                <MudText Typo="Typo.subtitle1" Class="text-error font-semibold mb-1"> Khoa</MudText>
                <MudSelect T="string" @bind-Value="SelectedFaculty" Placeholder="Chọn khoa" Class="mb-3">
                    @foreach (var faculty in Faculties)
                    {
                        <MudSelectItem Value="@faculty">@faculty</MudSelectItem>
                    }
                </MudSelect>

                <MudText Typo="Typo.subtitle1" Class="text-error font-semibold mb-1"> Môn</MudText>
                <MudSelect T="string" @bind-Value="SelectedSubject" Placeholder="Chọn môn" Class="mb-3">
                    @foreach (var subject in Subjects)
                    {
                        <MudSelectItem Value="@subject">@subject</MudSelectItem>
                    }
                </MudSelect>

                <MudText Typo="Typo.subtitle1" Class="text-error font-semibold mb-1"> Chương</MudText>
                <MudTextField @bind-Value="Chapter"
                              Placeholder="Nhập chương (VD: Chương 1)"
                              Variant="Variant.Outlined"
                              FullWidth="true"
                              Class="mb-3"/>

                <MudText Typo="Typo.subtitle1" Class="text-error font-semibold mb-1"> CLO</MudText>
                <MudSelect T="string" @bind-Value="SelectedCLO" Placeholder="Chọn CLO" Class="mb-5">
                    @foreach (var clo in CLOs)
                    {
                        <MudSelectItem Value="@clo">@clo</MudSelectItem>
                    }
                </MudSelect>

                <div class="d-flex flex-column align-items-center gap-2 mt-3">

                    <!-- Hàng 1 -->
                    <div class="d-flex justify-content-center gap-2 w-100">
                        <!-- Nút Lưu -->
                        <MudButton Variant="Variant.Filled"
                                   Style="@($"background-color:{Colors.Blue.Darken3}; color:white; height:42px; min-width:150px; text-transform:none;")"
                                   OnClick="SaveQuestion"
                                   Class="btn-save fw-bold rounded-md text-sm d-flex align-items-center justify-content-center shadow-sm">
                            <MudIcon Icon="@Icons.Material.Filled.Save" Size="Size.Small" Style="margin-right:6px;" />
                            Lưu
                        </MudButton>

                        <!-- Nút Xem trước -->
                        <MudButton Variant="Variant.Outlined"
                                   Style="@($"color:{Colors.Blue.Darken3}; border-color:{Colors.Blue.Darken3}; height:42px; min-width:150px; text-transform:none;")"
                                   OnClick="PreviewQuestion"
                                   Class="btn-preview fw-bold rounded-md text-sm d-flex align-items-center justify-content-center">
                            <MudIcon Icon="@Icons.Material.Filled.RemoveRedEye" Size="Size.Small" Style="margin-right:6px;" />
                            Xem trước
                        </MudButton>
                    </div>

                    <!-- Hàng 2 -->
                    <div class="d-flex justify-content-center w-100">
                        <MudButton Variant="Variant.Outlined"
                                   Style="@($"color:{Colors.Red.Darken3}; border-color:{Colors.Red.Darken3}; height:42px; width:310px; text-transform:none;")"
                                   OnClick="GoBack"
                                   Class="btn-back fw-bold rounded-md text-sm d-flex align-items-center justify-content-center">
                            <MudIcon Icon="@Icons.Material.Filled.ArrowBack" Size="Size.Small" Style="margin-right:6px;" />
                            Quay lại
                        </MudButton>
                    </div>

                </div>

            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>

