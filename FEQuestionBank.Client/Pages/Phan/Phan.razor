@page "/phan"
@inherits PhanBase
@inject ISnackbar Snackbar

<MudPaper Class="pa-6" Elevation="2">
    <MudText Typo="Typo.h4" Class="mb-6">Danh sách Phần</MudText>

    <!-- Tìm kiếm + Tạo mới -->
    <div class="d-flex gap-3 mb-5 flex-wrap align-center">
        <MudTextField @bind-Value="_searchTerm"
                      Placeholder="Tìm theo tên phần..."
                      Adornment="Adornment.Start"
                      AdornmentIcon="@Icons.Material.Filled.Search"
                      Variant="Variant.Outlined"
                      Class="flex-grow-1"
                      Style="max-width: 400px;"
                      Immediate="true"
                      DebounceInterval="500"
                      OnKeyDown="@(e =>
                                 {
                                     if (e.Key == "Enter") ;
                                 })" />

        <MudButton Variant="Variant.Filled"
                   StartIcon="@Icons.Material.Filled.Add"
                   Color="Color.Primary"
                   OnClick="OnCreateNew">
            Tạo mới
        </MudButton>
    </div>

    <!-- Loading -->
    @if (loading)
    {
        <div class="d-flex justify-center my-8">
            <MudProgressCircular Indeterminate="true" Size="Size.Large" />
        </div>
    }
    else if (phanList == null || !phanList.Any())
    {
        <MudAlert Severity="Severity.Info" Class="my-8">
            Không tìm thấy phần nào.
        </MudAlert>
    }
    else
    {
        <MudGrid GutterSize="3">
            @foreach (var phan in phanList)
            {
                <MudItem xs="12" sm="6" md="4" lg="3">
                    <MudCard Class="pa-4">
                        <MudCardContent>
                            <MudText Typo="Typo.h6">@phan.TenPhan</MudText>

                            <div class="d-flex flex-wrap gap-1 mt-2">
                                @if (phan.XoaTam == true)
                                {
                                    <MudChip T="string" Size="Size.Small" Color="Color.Error">Đã xóa tạm</MudChip>
                                }
                                @if (phan.LaCauHoiNhom)
                                {
                                    <MudChip T="string" Size="Size.Small" Color="Color.Warning">Nhóm</MudChip>
                                }
                                @if (phan.SoLuongCauHoi > 0)
                                {
                                    <MudChip T="int" Size="Size.Small" Color="Color.Success">@phan.SoLuongCauHoi câu</MudChip>
                                }
                            </div>

                            <MudText Typo="Typo.body2" Class="mt-2 text-muted">
                                Ngày tạo: @phan.NgayTao.ToString("dd/MM/yyyy")
                            </MudText>
                        </MudCardContent>

                        <MudCardActions Class="justify-end">
                            <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                           Color="Color.Primary"
                                           Size="Size.Small"
                                           OnClick="() => OnEdit(phan)" />
                            <MudIconButton Icon="@Icons.Material.Filled.Visibility"
                                           Color="Color.Info"
                                           Size="Size.Small"
                                           OnClick="() => OnViewDetail(phan)" />
                            <MudIconButton Icon="@Icons.Material.Filled.List"
                                           Color="Color.Tertiary"
                                           Size="Size.Small"
                                           OnClick="() => OnViewSubjects(phan)" />
                            <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                           Color="Color.Error"
                                           Size="Size.Small"
                                           OnClick="() => OnConfirmDelete(phan)" />
                        </MudCardActions>
                    </MudCard>
                </MudItem>
            }
        </MudGrid>
    }
</MudPaper>
