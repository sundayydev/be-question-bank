@page "/monhoc"
@page "/monhoc/khoa/{MaKhoa:guid}"
@using BeQuestionBank.Shared.DTOs.MonHoc
@inherits MonHocBase
@inject ISnackbar Snackbar


<MudPaper Style="min-height:600px ; width: 100%;padding: 30px">
    <MudText Typo="Typo.h4" Class="mb-6">@PageTitle</MudText>

    <!-- Ô tìm kiếm + nút tạo mới -->
    <div class="row mb-3 g-2 align-items-center">
        <div class="col">
            <MudTextField @bind-Value="_searchTerm"
                          Placeholder="Tìm theo tên môn học..."
                          Adornment="Adornment.Start"
                          AdornmentIcon="@Icons.Material.Filled.Search"
                          Immediate="true"
                          OnKeyDown="@(e => { if (e.Key == "Enter") { table?.ReloadServerData(); } })"
                          Style="width: 100%;" />
        </div>

        <div class="col-auto">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="OnCreateNew">
                <MudIcon Icon="@Icons.Material.Filled.Add" Class="mr-1" /> Tạo mới
            </MudButton>
        </div>
    </div>

    <!-- Bảng dữ liệu -->
    <MudTable ServerData="LoadServerData"
              Bordered="true"
              Hover="true"
              Striped="true"
              Dense="false"
              RowsPerPage="10"
              PageSizeOptions="new int[] {10, 20, 50}"
              Class="w-full text-base"
              @ref="table">

        <HeaderContent>
            <MudTh><MudTableSortLabel SortLabel="TenMonHoc" T="MonHocDto">Tên Môn Học</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortLabel="MaSoMonHoc" T="MonHocDto">Mã Số Môn Học</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortLabel="MaKhoa" T="MonHocDto">Khoa</MudTableSortLabel></MudTh>
            <MudTh Style="text-align:center;">Trạng Thái</MudTh>
            <MudTh Style="text-align:center;">Thao Tác</MudTh>
        </HeaderContent>

        <RowTemplate>
            <MudTd>@context.TenMonHoc</MudTd>
            <MudTd>@context.MaSoMonHoc</MudTd>
            <MudTd>@GetKhoaName(context.MaKhoa)</MudTd>
            <MudTd Style="text-align:center;">
                <MudChip T="string" Color="@(context.XoaTam == true ? Color.Error : Color.Success)">
                    @(context.XoaTam == true ? "Đã xóa tạm" : "Hoạt động")
                </MudChip>
            </MudTd>
            <MudTd Style="text-align:center;">
                <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Primary" Size="Size.Small" Class="mx-1" OnClick="() => OnEdit(context)" />
                @if (context.XoaTam == true)
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Restore" Color="Color.Success" Size="Size.Small" Class="mx-1" OnClick="() => OnRestore(context)" />
                }
                else
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small" Class="mx-1" OnClick="() => OnConfirmDelete(context)" />
                }
                <MudIconButton Icon="@Icons.Material.Filled.Visibility" Color="Color.Info" Size="Size.Small" Class="mx-1" OnClick="() => OnViewDetail(context)" />
            </MudTd>
        </RowTemplate>

        <NoRecordsContent>
            <MudText>Không tìm thấy môn học nào</MudText>
        </NoRecordsContent>

        <LoadingContent>
            <MudText>Đang tải dữ liệu...</MudText>
        </LoadingContent>

        <PagerContent>
            <MudTablePager InfoFormat="Hiển thị {first_item}-{last_item} của {all_items} mục" />
        </PagerContent>
    </MudTable>
</MudPaper>
