@page "/monhoc"
@using BeQuestionBank.Shared.DTOs.MonHoc
@inherits MonHocBase
@inject ISnackbar Snackbar

<MudContainer MaxWidth="MaxWidth.ExtraLarge">
    <MudBreadcrumbs Items="_breadcrumbs"/>
    <MudGrid Spacing="3" Style=" margin-bottom: 10px">
        <MudItem xs="12" sm="6" md="4">
            <InfoCard
                Icon="@Icons.Material.Filled.MenuBook"
                IconColor="Color.Primary"
                Title="Tổng số môn học "
                Value="@TotalMon.ToString()"/>
        </MudItem>

        <MudItem xs="12" sm="6" md="4">
            <InfoCard
                Icon="@Icons.Material.Filled.Done"
                IconColor="Color.Success"
                Title="Sô môn học còn hoạt động"
                Value="@ActiveMon.ToString()"/>
        </MudItem>

        <MudItem xs="12" sm="6" md="4">
            <InfoCard
                Icon="@Icons.Material.Filled.CloudUpload"
                IconColor="Color.Info"
                Title="Số môn học ngưng hoạt động"
                Value="@LockedMon.ToString()"
                BackgroundColor="#f5f9ff"/>
        </MudItem>
    </MudGrid>
    <!-- Ô tìm kiếm + nút tạo mới -->
    <div class="row mb-3 g-2 align-items-center">
        <!-- Ô tìm kiếm -->
        <div class="col">
            <div class="input-group align-items-center custom-input-group">
                <span class="input-group-text bg-light"
                      style="border-radius: 10px 0 0 10px; border: 1px solid #ced4da; border-right: none;">
                    <MudIcon Icon="@Icons.Material.Filled.Search" Size="Size.Medium"
                             Style="@($"color:{Colors.Blue.Darken3};")"/>
                </span>

                <div class="flex-grow-1">
                    <MudTextField @bind-Value="_searchTerm"
                                  Placeholder="Tìm theo tên mon hoc..."
                                  Variant="Variant.Text"
                                  Immediate="true"
                                  OnKeyDown="@(e =>
                                             {
                                                 if (e.Key == "Enter") table?.ReloadServerData();
                                             })"
                                  Class="shadow-none"
                                  Style="border-radius: 0 10px 10px 0; height:42px; padding-left:10px;"/>
                </div>
            </div>
        </div>

        <!-- Nút tạo mới -->
        <div class="col-auto">
            <MudButton Variant="Variant.Filled"
                       StartIcon="@Icons.Material.Filled.Add"
                       Style="@($"background-color:{Colors.Blue.Darken2}; color:white; border-radius:10px; padding:6px 16px;")"
                       OnClick="OnCreateNew">
                Tạo mới
            </MudButton>
        </div>
    </div>

    <!-- Bảng dữ liệu -->
    <MudTable ServerData="LoadServerData"
              Bordered="true"
              Hover="true"
              Striped="true"
              Dense="false"
              RowsPerPage="10"
              PageSizeOptions="new int[] {10, 20, 50}"
              Class="w-full text-base"
              @ref="table">

        <HeaderContent>
            <MudTh><MudTableSortLabel SortLabel="TenMonHoc" T="MonHocDto">Tên Môn Học</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortLabel="MaSoMonHoc" T="MonHocDto">Mã Số Môn Học</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortLabel="MaKhoa" T="MonHocDto">Khoa</MudTableSortLabel></MudTh>
            <MudTh Style="text-align:center;">Trạng Thái</MudTh>
            <MudTh Style="text-align:center;">Thao Tác</MudTh>
        </HeaderContent>

        <RowTemplate>
            <MudTd>@context.TenMonHoc</MudTd>
            <MudTd>@context.MaSoMonHoc</MudTd>
            <MudTd>@GetKhoaName(context.MaKhoa)</MudTd>
            <MudTd Style="text-align:center;">
                <MudChip T="string"
                         Size="Size.Small"
                         Style="@(
                                context.XoaTam == true
                                    ? $"background-color:{Colors.Red.Lighten4}; color:{Colors.Red.Darken3}; " +
                                      $"font-weight:400; width:80px"
                                    : $"background-color:{Colors.Green.Lighten4}; color:{Colors.Green.Darken3};" +
                                      $" font-weight:400; width:80px"
                                )">
                    @(context.XoaTam == true ? "Đã khóa" : "Hoạt động")
                </MudChip>
            </MudTd>

            <MudTd Style="text-align:center;">
                <MudIconButton Icon="@Icons.Material.Filled.Edit" Style="@($"color:{Colors.Blue.Darken3};")" Size="Size.Small" Class="mx-1" OnClick="() => OnEdit(context)"/>
                <MudIconButton Icon="@Icons.Material.Filled.Visibility" Style="@($"color:{Colors.Yellow.Darken3};")" Size="Size.Small" Class="mx-1" OnClick="() => OnViewDetail(context)"/>
                <MudIconButton Icon="@Icons.Material.Filled.Checklist" Style="@($"color:{Colors.Green.Darken3};")" Size="Size.Small" Class="mx-1" OnClick="() => OnPartNav(context)" />
                @if (context.XoaTam == true)
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Restore" Style="@($"color:{Colors.Gray.Darken3};")" Size="Size.Small" Class="mx-1" OnClick="() => OnRestore(context)"/>
                }
                else
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Delete" Style="@($"color:{Colors.Red.Darken3};")" Size="Size.Small" Class="mx-1" OnClick="() => OnConfirmDelete(context)"/>
                }
            </MudTd>
        </RowTemplate>

        <NoRecordsContent>
            <MudText>Không tìm thấy môn học nào</MudText>
        </NoRecordsContent>

        <LoadingContent>
            <MudText>Đang tải dữ liệu...</MudText>
        </LoadingContent>

        <PagerContent>
            <MudTablePager
                RowsPerPageString="Hàng mỗi trang"
                InfoFormat="Hiển thị {first_item}-{last_item} của {all_items} mục"/>
        </PagerContent>

    </MudTable>
</MudContainer>
