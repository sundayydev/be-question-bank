@using Microsoft.AspNetCore.Authorization
@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@attribute [Authorize]  

<MudLayout>
    @if (!HideLayout)
    {
        <!-- Header -->
        <Header OnMenuClick="ToggleDrawer" />

        <!-- Sidebar -->
        <Sidebar Open="_drawerOpen" />
    }

    <!-- Nội dung chính -->
    <MudMainContent Class="@MainContentCssClass">
        <CascadingValue Value="(Action<bool>)(hide => _hideLayout = hide)">
            @Body
        </CascadingValue>
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen = true;
    private bool _hideLayout;

    private void ToggleDrawer()
    {
        _drawerOpen = !_drawerOpen;
        StateHasChanged();
    }

    private bool HideLayout => _hideLayout || ShouldHideLayout();

    private bool ShouldHideLayout()
    {
        var relativePath = NavigationManager.ToBaseRelativePath(NavigationManager.Uri).ToLower();
        var hiddenPages = new[] { "login", "register", "forgot-password", "404" };
        return hiddenPages.Any(p => relativePath.StartsWith(p));
    }

    private string MainContentCssClass => HideLayout ? "mud-main-content-auth" : "";
}